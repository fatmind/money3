## 1️⃣ 目标定义

**目标收益与风险要求：**

* 年化收益率目标：≈ **15%**
* 最大回撤：≤ **10%**
* 夏普比率：≥ **1.0**
* 投资风格：稳健分散（国债 + 黄金 + 股票 + ETF）
* 调仓频率：**月度或季度**
* 策略核心思想：
  通过 **大模型（LLM）生成市场观点（views）**，并结合 **Black-Litterman/PyPortfolioOpt** 做组合权重优化，最终以 **vectorbt 回测** 验证绩效。

* 初期投资标的（达成一致）：`SPY`（美股大盘）、`GLD`（黄金）、`TLT`（美长期国债）；前期固定聚焦这 3 个标的，后续可按需扩充。

---

## 2️⃣ 系统方案组合

| 模块        | 工具 / 框架                              | 作用说明                                                                     |
| --------- | ------------------------------------ | ------------------------------------------------------------------------ |
| 🧩 数据采集   | **OpenBB SDK**                       | 抓取宏观、资产价格、ETF、国债收益率、黄金等数据；支持多资产类别。                       |
| 🧠 市场观点生成 | **DeepSeek LLM**（开源大模型）              | 输入市场数据、新闻摘要、宏观指标 → 输出资产“看涨 / 看跌 / 中性”观点 + 置信度。                           |
| 📊 组合优化   | **PyPortfolioOpt / Black-Litterman** | 将 LLM 生成的观点作为 “投资者 views” 融入 Black-Litterman 框架，计算最优权重（考虑风险、协方差矩阵、预期收益等）。 |
| ⚙️ 回测引擎   | **vectorbt**                         | 模拟月度调仓，计算年化收益、最大回撤、夏普比率、交易成本影响等。                                    |
| 📈 绩效评估   | pandas + numpy + matplotlib          | 生成收益曲线、风险指标、资产权重变化趋势图。                                                   |

---

## 3️⃣ 概要关键点

### 📍 数据层面

* **OpenBB 数据源一致性**：
  不同资产类别（国债、黄金、ETF、股票）需保证相同的时间范围与频率（如月度收盘价）。
* **数据更新周期**：
  若要接近实盘，应定期拉取最新数据（例如每月 1 日自动运行）。
* **宏观输入变量**：
  可额外添加 CPI、利率、美元指数、VIX 等指标供 LLM 判断宏观情绪。

---

### 🧠 大模型观点生成（LLM Layer）

* 注：LLM 扮演“虚拟投顾”角色，需要基于完整上下文先独立做一次决策，并输出可量化、可映射到 Black-Litterman 的 views。

* **输入内容（达成一致，需更丰富）**：

  * 投资目标与约束：目标年化 ≈15%，最大回撤 ≤10%，夏普 ≥1.0，调仓频率（月/季），交易成本假设等；
  * 当前组合状态：当前持仓权重（含基准 60/30/10）、持仓规模、持仓成本；
  * 绩效与风险状态：累计收益、近期收益、当期最大回撤、波动率等；
  * 市场与宏观信息：近 3–6 个月价格走势、CPI/利率/美元指数/VIX 等宏观指标；
  * 新闻与事件摘要：来自 OpenBB / RSS 的金融要闻；
  * 时间信息：严格使用当前期之前的数据与时间戳，避免前视偏差。

* **输出内容（结构化，供 Black-Litterman 使用）**：
  ```json
  {
    "horizon": "1m", 
    "views": [
      {
        "type": "absolute",
        "asset": "SPY",
        "expected_return": 0.18,
        "confidence": 0.7
      },
      {
        "type": "relative",
        "assets": ["SPY", "TLT"],
        "outperformance": 0.05,
        "confidence": 0.6
      }
    ],
    "rationale": "基于通胀回落与盈利修复，SPY 预期回报改善；在高利率环境下，SPY 相对 TLT 更具吸引力。",
    "timestamp": "2025-10-01"
  }
  ```

---

### 📊 组合优化（Black-Litterman Layer）

* **核心步骤：**

  1. 计算资产协方差矩阵；
  2. 用 CAPM 或均值收益生成先验；
  3. 将 LLM 观点映射为 views 矩阵（P、Q、Ω）；
  4. 用 Black-Litterman 得出后验期望收益；
  5. 用 PyPortfolioOpt 进行约束优化（含最大仓位、风险约束）。

* **优化约束：**

  * 基准参考组合（equilibrium）：股票 60% + 债券 30% + 黄金 10%（作为先验/基准，而非硬性限制）
  * 股票占比不会超过 70%，债券和黄金占比不会低于 30%。
  * 无杠杆

---

### ⚙️ 回测与绩效评估（vectorbt Layer）

* **调仓逻辑：**

  * 按月或季度根据新权重再平衡；
  * 加入交易成本（如 0.1%）；
  * 考虑滑点和延迟执行；

* **回测输出指标：**

  * 年化收益率（CAGR）
  * 最大回撤（MDD）
  * 夏普比率（Sharpe Ratio）
  * 年化波动率（Volatility）
  * 调仓次数 / 成本占比

* **图形输出：**

  * 组合净值曲线；
  * 各资产权重变化；
  * 年度收益柱状图；
  * 回撤曲线。

---

## ⚠️ 注意事项与潜在风险

| 类别    | 风险 / 注意点              | 对策                    |
| ----- | --------------------- | --------------------- |
| 数据滞后  | OpenBB 部分数据（如宏观指标）有延迟 | 使用近似或替代指标；延后执行        |
| 前视偏差  | LLM 分析可能读取到未来数据       | 加入日期校验，确保只用当期信息       |
| 观点波动性 | LLM 输出可能不稳定           | 平滑信号或加入置信度阈值          |
| 回测过拟合 | 参数或调仓频率调整太多           | 留出 Out-of-sample 测试区间 |
| 成本与滑点 | 交易成本低估会夸大收益           | 设置 realistic 交易摩擦系数   |
| 模型漂移  | LLM 观点与市场实际脱节         | 建立反馈机制（误差修正、信号加权）     |
